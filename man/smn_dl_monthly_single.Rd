% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dl_monthly_single.R
\name{smn_dl_monthly_single}
\alias{smn_dl_monthly_single}
\title{Download and Aggregate Monthly Climate Data (Single Station)}
\usage{
smn_dl_monthly_single(
  station,
  variables = "all",
  start_date = "1961-01-01",
  end_date = Sys.Date(),
  max_missing_frac = 0.2,
  output_format = c("reduce", "long"),
  aggregator = NULL,
  csv_file = NULL,
  daily_del_na = "no"
)
}
\arguments{
\item{station}{Character or numeric. SMN station code (passed to
\code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}}).}

\item{variables}{Character vector of variables to aggregate, or \code{"all"}.
Valid names are \code{"prec"}, \code{"evap"}, \code{"tmax"}, \code{"tmin"}. Default \code{"all"}.}

\item{start_date}{Start date (inclusive). Coerced with \code{as.Date()}.
Default \code{"1961-01-01"}. Passed to \code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}}.}

\item{end_date}{End date (inclusive). Coerced with \code{as.Date()}.
Default \code{Sys.Date()}. Passed to \code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}}.}

\item{max_missing_frac}{Numeric in \verb{[0, 1]}. If the fraction of missing days
in a month exceeds this threshold, the monthly value is set to \code{NA}.
Default \code{0.2}.}

\item{output_format}{Output format. Either \code{"long"} or \code{"reduce"}
(default \code{"reduce"}).}

\item{aggregator}{Optional \strong{single function} to apply to all variables
(e.g., \code{median}) \strong{or} a \strong{named list} mapping variable â†’ function,
e.g., \code{list(prec = sum, tmax = mean)}. If \code{NULL}, defaults are used:
\code{sum} for \verb{prec,evap} and \code{mean} for \verb{tmax,tmin}.}

\item{csv_file}{Optional path to write CSV output.
\itemize{
\item For \code{"long"}: a single CSV at \code{csv_file}.
\item For \code{"reduce"} with multiple variables: one file per variable, using
\code{paste0(file_path_sans_ext(csv_file), "_", var, ".csv")}.
}}

\item{daily_del_na}{Character \code{"yes"} or \code{"no"}; forwarded to
\code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}} to control row removal at the \strong{daily} stage.
Default \code{"no"}. Note: the monthly completeness rule is applied \strong{after}
downloading daily data; this argument is only about cleaning rows at the
daily function.}
}
\value{
\itemize{
\item If \code{output_format = "long"}: a single \code{data.frame} with columns
\verb{station, latitude, longitude, altitude, date, <vars...>}.
\item If \code{output_format = "reduce"} and a single variable was requested:
a wide \code{data.frame}.
\item If \code{output_format = "reduce"} and multiple variables were requested:
a \strong{named list} of wide \code{data.frame}s (one per variable).
}
}
\description{
Downloads daily SMN data for a station using \code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}}, then
aggregates it to monthly values for one or more variables applying a
completeness rule per month. The function can return either a \emph{long} table
(one row per month and a column per requested variable), or \emph{reduce} tables
(one per variable, with \code{YEAR}, \code{JAN..DEC}, and annual summaries).
}
\details{
\subsection{Long format}{

If \code{output_format = "long"}, the result contains one row per month with
columns:
\verb{station, latitude, longitude, altitude, date, <vars...>},
where \verb{<vars...>} are the requested subset among \verb{prec, evap, tmin, tmax}.
The \code{date} column is the first day of each month.
}

\subsection{Reduce format}{

If \code{output_format = "reduce"}, the result is a wide table (or a named list of
tables when multiple variables are requested) with columns:
\verb{YEAR, JAN..DEC, ACUM, PROM, MONTHS}.
For sum-type variables (\code{prec}, \code{evap}) \code{ACUM} is the row \strong{sum};
for mean-type variables (\code{tmax}, \code{tmin}) \code{ACUM} is the row \strong{mean}.
\code{PROM} is always the row mean across valid months; \code{MONTHS} is the count of
non-\code{NA} months.

Daily data are obtained via \code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}} with
\code{output_format = "full"} (to carry station metadata). Missing fraction is
computed against the \strong{calendar} number of days per month within the
requested window; absent daily rows count as missing. The \code{date} in the long
table is set to the first day of each month (\code{YYYY-MM-01}).
}
}
\examples{
\dontrun{
# 1) All variables, monthly, long format (one row per month)
m_long <- smn_dl_monthly_single(
  station = "15101",
  variables = "all",
  start_date = "1984-01-01",
  end_date   = "2020-12-31",
  output_format = "long"
)

# 2) Only precipitation, reduce format (wide)
m_prec <- smn_dl_monthly_single("15101", variables = "prec", output_format = "reduce")

# 3) Two variables, strict completeness (<= 10\% missing), custom aggregator
m_custom <- smn_dl_monthly_single(
  station = "15101",
  variables = c("tmax","tmin"),
  max_missing_frac = 0.10,
  aggregator = median,
  output_format = "long"
)

# 4) Control daily cleaning from here (do not drop NAs before monthly)
m_cfg <- smn_dl_monthly_single(
  station = "15101",
  variables = "all",
  daily_del_na = "no",
  output_format = "long"
)
}

}
