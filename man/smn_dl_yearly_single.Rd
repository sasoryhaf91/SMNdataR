% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dl_yearly_single.R
\name{smn_dl_yearly_single}
\alias{smn_dl_yearly_single}
\title{Download and Aggregate \strong{Yearly} Climate Data (Reduce Format)}
\usage{
smn_dl_yearly_single(
  station,
  start_date = "1961-01-01",
  end_date = Sys.Date(),
  variables = "all",
  max_missing_frac = 0.2,
  aggregator = NULL,
  csv_file = NULL
)
}
\arguments{
\item{station}{Character or numeric. SMN station code (e.g., \code{"15101"}).}

\item{start_date}{Character or \code{Date}. Start of the daily window
(default \code{"1961-01-01"}, inclusive).}

\item{end_date}{Character or \code{Date}. End of the daily window
(default \code{Sys.Date()}, inclusive).}

\item{variables}{Character vector of variables to summarize. Any subset of
\code{c("prec","evap","tmax","tmin")}. Use \code{"all"} to include all four
(default \code{"all"}).}

\item{max_missing_frac}{Numeric in [0, 1]. Maximum allowed \strong{fraction of
missing days per year} to keep that year's aggregate for a variable
(default \code{0.2}). When the missing fraction exceeds the threshold, that
yearly value is set to \code{NA}.}

\item{aggregator}{Either:
\itemize{
\item \code{NULL} (default): uses \code{sum} for \verb{"prec","evap"} and \code{mean} for
\verb{"tmax","tmin"}, or
\item a \strong{single function} (e.g., \code{median}) applied to all variables, or
\item a \strong{named list} mapping variables to functions,
e.g. \code{list(prec = sum, evap = sum, tmax = mean, tmin = mean)}.
}}

\item{csv_file}{Optional file path. If non-\code{NULL}, the result is written to
CSV (\code{row.names = FALSE}) and also returned.}
}
\value{
A base \code{data.frame} in \strong{reduce} (wide) format with columns:
\verb{station, latitude, longitude, altitude, YEAR, <variables...>}.
If no data are available, returns an empty table with the same schema.
}
\description{
Downloads \strong{daily} data for an SMN station using
\code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}} and aggregates to \strong{yearly} values for one or more
variables, with quality control based on an allowed fraction of missing days
per year. The output is always in \strong{reduce (wide)} format: one row per year
with the requested variables as columns plus station metadata.
}
\details{
Internally calls \code{\link[=smn_dl_daily_single]{smn_dl_daily_single()}} with \code{output_format = "full"} to
fetch daily data and station metadata. The missing-data rule is computed
\strong{per year and per variable} as \verb{#(NA) / #(days in year)}.
}
\examples{
\dontrun{
# All variables in reduce format (default)
y1 <- smn_dl_yearly_single(
  station = "15101",
  start_date = "2000-01-01",
  end_date   = "2005-12-31",
  variables  = "all"
)

# Subset of variables and custom aggregator
y2 <- smn_dl_yearly_single(
  station = "15101",
  start_date = "1990-01-01",
  end_date   = "1999-12-31",
  variables  = c("prec","tmax"),
  aggregator = list(prec = sum, tmax = median)
)
}

}
