% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tl_find_nearby.R
\name{smn_tl_find_nearby}
\alias{smn_tl_find_nearby}
\title{Find Nearby SMN Stations and/or NASA Grid Nodes (Hybrid)}
\usage{
smn_tl_find_nearby(
  station = NULL,
  lat = NULL,
  lon = NULL,
  sources = c("both", "smn", "nasa"),
  mode = c("radius", "k"),
  radius_km = 20,
  k = 10,
  bbox_pad_km = 2
)
}
\arguments{
\item{station}{Optional. SMN station code to use as reference point.}

\item{lat, lon}{Optional numeric coordinates (decimal degrees WGS84) for the
reference point. If \code{station} is not supplied, both \code{lat} and
\code{lon} must be provided.}

\item{sources}{Character vector: \code{"smn"}, \code{"nasa"} or \code{"both"}
(default). Controls which catalogs are queried.}

\item{mode}{Selection mode: \code{"radius"} (default) or \code{"k"}.}

\item{radius_km}{Numeric radius in kilometers (used when \code{mode="radius"}).
Default 20.}

\item{k}{Integer number of nearest neighbors (used when \code{mode="k"}).
Default 10.}

\item{bbox_pad_km}{Numeric padding (km) for a quick prefiltering bounding
box before exact distances (speeds up large catalogs). Default 2 km.}
}
\value{
A data frame with rows for the nearby nodes and columns:
\code{source} (factor: \code{"SMN"} or \code{"NASA_POWER"}),
\code{station} (character ID; for grid is the numeric node code),
\code{latitude}, \code{longitude}, \code{altitude},
\code{distance_km} (great-circle distance to the reference point).
Rows are ordered by \code{distance_km}.
}
\description{
Given a reference point (station code or coordinates), return nearby nodes
from the SMN station catalog and/or a prebuilt NASA-like grid (e.g. 1-km DEM
grid) with great-circle distances. Two selection modes are supported:
\itemize{
\item \code{mode = "radius"}: all nodes within \code{radius_km}
\item \code{mode = "k"}: the \code{k} nearest nodes
}
}
\details{
The function expects two datasets bundled in the package (or preloaded):
\itemize{
\item \code{stations}: SMN catalog with columns \code{station, latitude, longitude, altitude} (altitude may be \code{NA})
\item \code{gridmex}: Grid of candidate nodes with columns \code{station, latitude, longitude, altitude}
}

The great-circle distance is computed with the haversine formula
via \pkg{geosphere}. A coarse degree bounding box
(\code{radius_km + bbox_pad_km})/111 is applied first for speed.

If \code{station} (reference) is supplied, its coordinates are taken from
\code{stations}. If not found, an error is raised unless \code{lat/lon} are
provided.
}
\examples{
\dontrun{
# 1) 20 km around station 15101, combining SMN + Grid
smn_tl_find_nearby(station = "15101", mode = "radius", radius_km = 20)

# 2) 15 vecinos m√°s cercanos solo del grid, a coordenadas dadas
smn_tl_find_nearby(lat = 19.29, lon = -99.66, sources = "nasa",
                   mode = "k", k = 15)
}
}
